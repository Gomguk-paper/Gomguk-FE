# 백엔드 실행 가이드

## 1단계: 의존성 설치

### 방법 1: 가상환경 사용 (권장)

```bash
cd backend

# 가상환경 생성
python3 -m venv venv

# 가상환경 활성화
source venv/bin/activate  # Linux/Mac
# 또는
venv\Scripts\activate  # Windows

# 의존성 설치
pip install -r requirements.txt
```

### 방법 2: 사용자 권한으로 설치

```bash
cd backend
pip install --user -r requirements.txt
```

## 2단계: 환경 변수 설정

```bash
# .env 파일 생성
cp env.example .env

# .env 파일 편집 (선택사항)
# OPENAI_API_KEY가 없어도 데모 모드로 동작합니다
nano .env  # 또는 원하는 에디터 사용
```

`.env` 파일 내용:
```env
DATABASE_URL=sqlite:///./data/papers.db
OPENAI_API_KEY=your_key_here  # 선택사항
API_HOST=0.0.0.0
API_PORT=8000
ARXIV_CATEGORIES=cs.AI,cs.LG,cs.CV,cs.CL
MAX_PAPERS_PER_CRAWL=100
TOP_CITATIONS_COUNT=5
```

## 3단계: 데이터베이스 초기화

```bash
python3 -c "from database import init_db; init_db()"
```

## 4단계: 데모 데이터 추가 (선택사항)

AI 논문 상위 5개를 데이터베이스에 추가합니다:

```bash
python3 init_demo_data.py
```

## 5단계: 서버 실행

### 방법 1: Python 스크립트로 실행

```bash
python3 main.py
```

### 방법 2: uvicorn 직접 실행

```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 방법 3: 실행 스크립트 사용

```bash
bash run.sh
```

## 서버 접속

서버가 실행되면 다음 주소에서 접속할 수 있습니다:

- **API 서버**: http://localhost:8000
- **API 문서 (Swagger)**: http://localhost:8000/docs
- **API 문서 (ReDoc)**: http://localhost:8000/redoc

## API 테스트

### 추천 논문 조회

```bash
curl -X POST "http://localhost:8000/api/recommendations" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user",
    "tags": [{"name": "NLP", "weight": 5}],
    "level": "researcher",
    "daily_count": 5
  }'
```

또는 브라우저에서 http://localhost:8000/docs 에 접속하여 인터랙티브하게 테스트할 수 있습니다.

## 파이프라인 실행 (크롤링-선별-요약)

수동으로 파이프라인을 실행하려면:

```bash
python3 pipeline.py
```

이 명령은:
1. arXiv에서 최신 논문 크롤링
2. 인용수 기준 상위 5개 논문 선별
3. 선별된 논문 요약 생성
4. 데이터베이스에 저장

## 문제 해결

### 패키지 설치 오류

만약 `sgmllib3k` 설치에 실패하면:

```bash
pip install --user sgmllib3k
```

또는 가상환경을 사용하세요.

### 포트가 이미 사용 중

다른 포트를 사용하려면:

```bash
uvicorn main:app --host 0.0.0.0 --port 8001
```

또는 `.env` 파일에서 `API_PORT=8001`로 변경

### 데이터베이스 오류

데이터베이스 파일을 삭제하고 다시 초기화:

```bash
rm -rf data/
python3 -c "from database import init_db; init_db()"
python3 init_demo_data.py
```
